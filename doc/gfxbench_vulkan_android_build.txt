# How to build GFXBench Vulkan for Android

## Table Of Contents

1. [Software requirements](#software_requirements)
2. [Build steps](#build_steps)
3. [Notes](#notes)

##<a name="software_requirements"></a> 1. Software requirements

**Build**

```
./sdkmanager  "ndk;28.0.12674087" "build-tools;35.0.0" "platforms;android-35" "platform-tools" "cmdline-tools;latest"

  Path                 | Version           | Description                             | Location
  -------              | -------           | -------                                 | -------
  build-tools;35.0.0   | 35.0.0            | Android SDK Build-Tools 35              | build-tools/35.0.0
  cmdline-tools;latest | 16.0              | Android SDK Command-line Tools (latest) | cmdline-tools/latest
  ndk;28.0.12674087    | 28.0.12674087 rc2 | NDK (Side by side) 28.0.12674087        | ndk/28.0.12674087
  platform-tools       | 35.0.2            | Android SDK Platform-Tools              | platform-tools
  platforms;android-35 | 1                 | Android SDK Platform 35                 | platforms/android-35
```

- On Windows suggested shell is Git Bash (Cygwin nor WSL is not supported)
   https://git-scm.com/downloads

- Android NDK 28.0.12674087 (tested version), GCC is no longer supported
   http://developer.android.com/sdk/ndk/index.html

- Android SDK, API Level 35 (recommended versions, store version built with API 35)
   http://developer.android.com/sdk/index.html

- CMake 3.5.0 or newer (tested with CMake 3.21)
   http://www.cmake.org/cmake/resources/software.html

- Swig 3.0.12 or 4.0.2 (tested with 3.0.12 and 4.0.2)
  http://swig.org/download.html

- Java Development Kit (e.g.: openjdk17)

- Add cmake and swigwin applications to `PATH` (on Windows)

- Set next environment variables to appropriately
   `ANDROID_NDK`
   `ANDROID_HOME`
   `NG_CMAKE_TOOLCHAIN_FILE`

    e.g.(On Windows):

        export ANDROID_NDK="$HOME/AppData/Local/Android/Sdk/ndk/24.0.8215888/"
        export ANDROID_HOME="$HOME/AppData/Local/Android/Sdk"
        export NG_CMAKE_TOOLCHAIN_FILE="$HOME/AppData/Local/Android/Sdk/ndk/24.0.8215888/build/cmake/android.toolchain.cmake"

   On Windows you may set up manually path of make.exe

       export CMAKE_MAKE_PROGRAM="$HOME/AppData/Local/Android/Sdk/ndk/24.0.8215888/prebuilt/windows-x86_64/bin/make.exe"

##<a name="build_steps"></a> 2. Build Steps

**Two steps needed to build:**

1. Build thirdparty libraries (`build-3rdparty.sh`)
2. Build GFXBench (`build.sh`)

**Steps to build an apk**

    export WORKSPACE=$PWD
    export PLATFORM=android-arm64-v8a
    export CONFIG=Release
    export APPLICATION_TYPE=gui

    scripts/build-3rdparty.sh
    scripts/build.sh

By default we provide a debug keys for signing: app_android/debug.jks
The final apk file will be placed into the `tfw-pkg` folder.

The environment variables accept the following values:

* `CONFIG`
	* Debug
	* Release

* `PLATFORM`
	* android-armv7a
	* android-arm64-v8a
	* android-x86
	* android-x86-64

* `APPLICATION_TYPE`
	* developer
	* gui

**gui**

This application type creates a GUI application with a test selector and result browser.
The resulting apk file that can be installed in traditional way via adb.

**developer**

The developer application type creates a native `testfw_app` which lists the available test configurations, can select and run a single test, then displays the result.

The apk can be installed via adb, but the test configuration files and test data must be installed manually. For example:

    WORKSPACE=$PWD PLATFORM=android-armv7a CONFIG=Release APPLICATION_TYPE=developer scripts/build.sh

	adb install tfw-apk/apk/testfw_app-release.apk

	adb push tfw-pkg/config /sdcard/kishonti/tfw/config
	adb push tfw-pkg/data /sdcard/kishonti/tfw/data

In subsequent invocations, the build times can be reduced with `BUNDLE_DATA=false`, so the build script does not copy the data into the `tfw-pkg` folder again.

	BUNDLE_DATA=false WORKSPACE=$PWD PLATFORM=android-armv7a CONFIG=Release APPLICATION_TYPE=developer scripts/build.sh

Starting `testfw_app`:

1. Start `testfw_app` from the Android app list.
2. Select the test and tap start.

##<a name="notes"></a> 3. Notes

* To link to the Vulkan you have to provide a `libvulkan.so` and put into:
	`frameworks/ngl/src/v1.0.3/android/lib/[android-armv7a][android-x86]/libvulkan.so`
* OR if you have other architecture type:
	* Set the path of `libvulcan.so` in `frameworks/ngl/src/CMakeLists.txt`
	* Find and replace the `VULKAN_LIBS` variable.
