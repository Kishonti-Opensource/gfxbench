(function(e){function t(e){e.hooks.processOptions.push(n)}function n(e){e.hooks.draw.push(r)}function r(t,n){function u(){return 12}var r=t.getOptions();if(!r.legend.show)return;var i=t.getPlaceholder();var s=r.legend.container||i.find(".legend");var o={style:i.css("font-style"),size:Math.round(.8*(+i.css("font-size").replace("px","")||13)),variant:i.css("font-variant"),weight:i.css("font-weight"),family:i.css("font-family")};n.font=o.style+" "+o.variant+" "+o.weight+" "+o.size+"px '"+o.family+"'";n.textAlign="left";n.textBaseline="bottom";n.fillStyle="#F00";var a=t.getData();var f=t.getPlotOffset();var l=t.height();var c=t.width();var h=r.legend.labelFormatter;var p=0,d=0;var v=0;var m,g;for(var y=0;y<a.length;++y){m=a[y];g=m.label;if(!g)continue;v++;if(h)g=h(g,m);labelWidth=n.measureText(g).width;if(r.legend.horizontal){p+=labelWidth}else{if(labelWidth>p)p=labelWidth}}var b=22;var w=5;var E=18;if(r.legend.horizontal){p=p+v*(b+w);d=E}else{p=p+b+w;d=v*E}var S,x;if(r.legend.container!=null){S=e(r.legend.container).offset().left;x=e(r.legend.container).offset().top}else{var T="";var N=r.legend.position;var C=r.legend.margin;if(C[0]==null)C=[C,C];if(N.charAt(0)=="n")x=Math.round(f.top+r.grid.borderWidth+C[1]);else if(N.charAt(0)=="s")x=Math.round(f.top+r.grid.borderWidth+l-C[0]-d);if(N.charAt(1)=="e")S=Math.round(f.left+r.grid.borderWidth+c-C[0]-p);else if(N.charAt(1)=="w")S=Math.round(f.left+r.grid.borderWidth+C[0]);if(r.legend.backgroundOpacity!=0){var k=r.legend.backgroundColor;if(k==null)k=r.grid.backgroundColor;if(k&&typeof k=="string"){n.globalAlpha=r.legend.backgroundOpacity;n.fillStyle=k;n.fillRect(S,x,p,d);n.globalAlpha=1}}}var L=S+2,A;for(var y=0;y<a.length;++y){m=a[y];g=m.label;if(!g)continue;if(h)g=h(g,m);if(r.legend.horizontal){A=x+2}else{L=S;A=x+y*18}n.fillStyle=r.legend.labelBoxBorderColor;n.fillRect(L,A,18,14);n.fillStyle="#FFF";n.fillRect(L+1,A+1,16,12);n.fillStyle=m.color;n.fillRect(L+2,A+2,14,10);L=L+22;A=A+o.size+2;n.fillStyle=r.legend.color;n.fillText(g,L,A);if(r.legend.horizontal){L=L+n.measureText(g).width+w}}s.hide()}e.plot.plugins.push({init:t,options:{},name:"legendoncanvas",version:"1.0"})})(jQuery)