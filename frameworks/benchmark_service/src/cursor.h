/*
 * Copyright (c) 2005-2025, Kishonti Ltd
 * SPDX-License-Identifier: BSD-3-Clause
 * This file is part of GFXBench. See the top-level LICENSE file for details.
 */
#ifndef CURSOR_H
#define CURSOR_H

#include "benchmarkservice_export.h"

#include <memory>
#include <string>



/**
 * Notifies the application about events in the cursor. All methods are dispatched on the thread
 * calling BenchmarkService::processEvents.
 * @see BenchmarkService::processEvents
 */
class CursorCallback
{
public:
    virtual ~CursorCallback() {}

    /**
     * Called before the content of the rows starting from first and ending with last (inclusive)
     * change.
     * @param first index of the first row to change.
     * @param last index of the last row to change.
     */
    virtual void BENCHMARK_SERVICE_API dataSetWillChange(int first, int last) = 0;

    /**
     * Called after the content of the rows starting from first and ending with last (inclusive)
     * changed.
     * @param first index of the first row to change.
     * @param last index of the last row to change.
     */
    virtual void BENCHMARK_SERVICE_API dataSetChanged(int first, int last) = 0;

    /**
     * Called befored the whole content of the Cursor is replaced. Even the number of rows might
     * change.
     */
    virtual void BENCHMARK_SERVICE_API dataSetWillBeInvalidated() = 0;

    /**
     * Called after the whole content of the Cursor is replaced or number of rows changed.
     */
    virtual void BENCHMARK_SERVICE_API dataSetInvalidated() = 0;
};



/**
 * A cursor implements a table-like structure, representing the result of a database query or a
 * list of objects in general. This is intended to be used in platform specific list adapter or
 * model classes that are behind list widgets on the UI.
 * The interface of this class is designed to mimic the java class android.database.Cursor
 * (http://developer.android.com/reference/android/database/Cursor.html). In fact the wrapper
 * generated by swig for this class extends android.database.AbstractCursor so it can be used
 * directly in an android.widget.CursorAdapter.
 * This class is designed to have a COM-like interface, see BenchmarkService for further details.
 * @see BenchmarkService
 */
class Cursor
{
public:
    /**
     * Represents a field type.
     */
    enum Type {
        FIELD_TYPE_NULL = 0,
        FIELD_TYPE_INTEGER = 1,
        FIELD_TYPE_FLOAT = 2,
        FIELD_TYPE_STRING = 3,
        FIELD_TYPE_BLOB = 4
    };

    /**
     * Destroys the object at pointer if it is not null.
     * @param pointer
     */
    static void release(Cursor* pointer) { if (pointer) pointer->destroy(); }

    /**
     * Destroys the object and frees the memory it occupies.
     */
    virtual void BENCHMARK_SERVICE_API destroy() = 0;

    /**
     * @returns the number of fields in a row.
     */
    virtual int BENCHMARK_SERVICE_API getColumnCount() const = 0;
    int getColumnIndex(const char* columnName) const {
        std::string name = columnName;
        for (int i = 0; i < getColumnCount(); ++i) {
            if (getColumnName(i) == name) {
                return i;
            }
        }
        return -1;
    }

    /**
     * @param column.
     * @returns the name of the field in a column.
     */
    virtual const char* BENCHMARK_SERVICE_API getColumnName(int column) const = 0;

    /**
     * @returns the number of rows in the Cursor.
     */
    virtual int BENCHMARK_SERVICE_API getCount() const = 0;

    /**
     * @param column
     * @returns the type of the field in a column.
     */
    virtual int BENCHMARK_SERVICE_API getType(int column) const = 0;

    /**
     * Casts the selected field to a specific type and returns it.
     * @see moveToPosition
     * @param column
     * @returns the value in column and the selected row.
     */
    virtual bool BENCHMARK_SERVICE_API getBoolean(int column) const = 0;
    virtual short BENCHMARK_SERVICE_API getShort(int column) const = 0;
    virtual int BENCHMARK_SERVICE_API getInt(int column) const = 0;
    virtual long long BENCHMARK_SERVICE_API getLong(int column) const = 0;
    virtual float BENCHMARK_SERVICE_API getFloat(int column) const = 0;
    virtual double BENCHMARK_SERVICE_API getDouble(int column) const = 0;
    std::string getString(int column) const { return getBlob(column); }

    /**
     * @see moveToPosition
     * @param column
     * @returns the value in column and the selected row as a byte array.
     * @note it is safer to use getBlob for the same purpose.
     */
    virtual void BENCHMARK_SERVICE_API getBlobPointer(
            int column,
            const char** pointer,
            size_t* size) const = 0;

    /**
     * @see moveToPosition
     * @param column
     * @returns the value in column and the selected row as a byte array.
     */
    std::string getBlob(int column) const {
        const char* pointer;
        size_t size;
        getBlobPointer(column, &pointer, &size);
        return std::string(pointer, size);
    }

    /**
     * @param column
     * @returns true if the value at getPosition() and column is null, false otherwise.
     */
    virtual bool BENCHMARK_SERVICE_API isNull(int column) const = 0;

    /**
     * @returns the zero based index of the currently selected row.
     */
    virtual int BENCHMARK_SERVICE_API getPosition() const = 0;

    /**
     * @row
     * Selects the row to get values from.
     */
    virtual bool BENCHMARK_SERVICE_API moveToPosition(int row) = 0;

    /**
     * @param callback a callback through which the application is notified about changes in the
     * cursor.
     */
    virtual void BENCHMARK_SERVICE_API setCallback(CursorCallback* callback) = 0;
protected:
    virtual ~Cursor() {}
};



#endif // CURSOR_H
